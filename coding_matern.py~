#!/usr/bin/python

import numpy as np
import matplotlib
matplotlib.use('Agg')
#import matplotlib.pyplot as plt
#import matplotlib.cm as cm
import sys
from videosink import VideoSink, grayscale
from neuron import PoissonNeuron, IFNeuron, PoissonPlasticCode, PoissonPlasticNeuron
from gaussianenv import GaussianEnv

zeta = 2
L = 0.8
N = 1
a = np.zeros(N*N)
sigma = 0.001
gamma = 3.33
eta = 3.162
dt = 0.01
order = 1
alpha = 0.1
phi = 10

time = 10.0
dt = 0.001
repetitions = 1000

e = GaussianEnv(zeta,gamma,eta,L,N,-2.0,-2.0,4.0,4.0,sigma,order)

code = PoissonCode(alpha)

covars = np.zeros((repetitions,int(time/dt)))

for i in range(repetitions):
	mu = np.zeros((order+1,))
	sigma = np.eye(order+1)
	for j in range(int(time/dt)):
		s = e.samplestep(dt)
		spi = code.spikes(s,dt)	
		if 

delete_them = []



for i in range(0,nframes):
	plot = e.samplestep(dt)
	p =	vgr(plot)
	spi = neuron.spike(plot,dt)
	video.run(p.astype(np.uint8))
	print spi
# 	f = plt.figure()
# 	plt.imshow(plot,cmap = cm.Greys_r,extent=[-2,2,-2,2], vmin=-3, vmax = 3)
# 	plt.imshow(p.astype(np.uint8),cmap=cm.Greys_r, vmin = 0, vmax = 255)
# 	filename = prefix+str('%05d' % i) + '.png'
# 	delete_them.append(filename)
#  	plt.savefig(filename, dpi = 100)
# 	print 'Wrote plot to ', filename
# 	plt.close(f)
	#plt.colorbar()

video.close()

# 
# command = ('mencoder',
#            'mf://*%s*.png' %prefix,
#            '-mf',
#            'type=png:w=800:h=600:fps=25',
#            '-ovc',
#            'lavc',
#            '-lavcopts',
#            'vcodec=mpeg4',
#            '-oac',
#            'copy',
#            '-o',
#            outfile)
#            
# print "\n\nabout to execute:\n%s\n\n" % ' '.join(command)
# subprocess.check_call(command)
# print "\n\n The movie was written to 'output.avi'"
# 
# for i in delete_them:
# 	command = 'rm '+i
# 	print 'running ',command
# 	os.system(command)
